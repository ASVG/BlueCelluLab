#!/bin/bash

set -e
set -x 

echo "###"
echo "### WARNING Make sure you rebuild/install BGLibPy before running theses tests !"
echo "###"

ENABLE_PIP="@ENABLE_PIP@"
if [ ! "${ENABLE_PIP}" == "ON" ]
then
    export PYTHONPATH=@PYTHON_PACKAGE_INSTALL_DIR@:${PYTHONPATH}
fi

ENABLE_COVERAGE="@ENABLE_COVERAGE@"
ENABLE_XUNITS="@ENABLE_XUNITS@"

if [  "${ENABLE_COVERAGE}" == "ON" ]
then
    COVERAGE_OPTIONS='--with-coverage --cover-package=bglibpy --cover-xml --cover-xml-file=@CMAKE_CURRENT_BINARY_DIR@/coverage.xml'
else
    COVERAGE_OPTIONS=''
fi

if [ "${ENABLE_XUNITS}" == "ON" ]
then
    XUNIT_OPTIONS='--with-xunit --xunit-file=@CMAKE_CURRENT_BINARY_DIR@/xunit.xml'
else
    XUNIT_OPTIONS=''
fi

# { cd @CMAKE_CURRENT_BINARY_DIR@; nosetests -v -x -s; } && { cd @CMAKE_CURRENT_SOURCE_DIR@; nosetests -v -x -s ${COVERAGE_OPTIONS} ${XUNIT_OPTIONS} ${@}; }
{ cd @CMAKE_CURRENT_SOURCE_DIR@; nosetests -v -x -s ${COVERAGE_OPTIONS} ${XUNIT_OPTIONS} ${@}; }

